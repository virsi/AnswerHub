{% extends 'base.html' %}
{% load static %}

{% block title %}Вопросы с тегом [{{ tag.name }}] - AnswerHub{% endblock %}

{% block content %}
<div class="main-layout">
    <div class="content">
        <div class="tag-header-top">
            <a href="{% url 'questions:ask' %}" class="btn btn-primary">Задать вопрос</a>
        </div>

        <!-- Заголовок тега -->
        <div class="tag-header">
            <span class="tag-badge large">{{ tag.name }}</span>
            <h1>Вопросы с тегом [{{ tag.name }}]</h1>
            {% if tag.description %}
            <p class="tag-description">{{ tag.description }}</p>
            {% endif %}
        </div>

        <!-- Список вопросов -->
        <div class="questions-list">
            {% for question in page.object_list %}
            <div class="question-card">
                <div class="vote-buttons">
                    <button class="vote-btn vote-up">↑</button>
                    <span class="vote-count">{{ question.votes }}</span>
                    <button class="vote-btn vote-down">↓</button>
                </div>

                <div class="question-content">
                    <h3><a href="{% url 'questions:detail' question.id %}">{{ question.title }}</a></h3>
                    <p>{{ question.content|truncatewords:30 }}</p>

                    <div class="tags">
                        {% for tag in question.tags.all %}
                        <a href="{% url 'tags:detail' tag.name %}" class="tag">{{ tag.name }}</a>
                        {% endfor %}
                    </div>

                    <div class="meta">
                        <span>спросил {{ question.created_at|timesince }} назад</span>
                        <span>{{ question.answers.count }} ответов</span>
                        <div class="author-info">
                            <div class="user-avatar-small">
                                <img src="{% if question.author.avatar %}{{ question.author.avatar.url }}{% else %}{% static 'img/avatar-placeholder.jpg' %}{% endif %}"
                                     alt="Аватар {{ question.author.username }}" class="avatar-img">
                            </div>
                            <span>{{ question.author.username }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="no-questions">
                <h3>Пока нет вопросов с этим тегом</h3>
                <p>Будьте первым, кто задаст вопрос с тегом "{{ tag.name }}"!</p>
                <a href="{% url 'questions:ask' %}" class="btn btn-primary">Задать вопрос</a>
            </div>
            {% endfor %}
        </div>

        <!-- Пагинация -->
        {% include 'includes/pagination.html' with page=page %}
    </div>

    <aside class="sidebar">
        <div class="sidebar-card">
            <h3>Статистика тега</h3>
            <div class="tag-stats">
                <div class="stat-item">
                    <span class="stat-label">Всего вопросов:</span>
                    <span class="stat-value">{{ tag.questions.count }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Использований:</span>
                    <span class="stat-value">{{ tag.usage_count }}</span>
                </div>
            </div>
        </div>

        <div class="sidebar-card">
            <h3>Похожие теги</h3>
            <div class="tags">
                {% for similar_tag in popular_tags %}
                    {% if similar_tag.name != tag.name %}
                    <a href="{% url 'tags:detail' similar_tag.name %}" class="tag">{{ similar_tag.name }}</a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </aside>
</div>
{% endblock %}
