{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title|default:"–ù–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã" }} - AnswerHub{% endblock %}

{% block content %}
<div class="main-layout">
    <div class="content">
        <div class="questions-header">
            <a href="{% url 'questions:ask' %}" class="btn btn-primary">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</a>
        </div>

        <div class="sorting-options">
            <span class="sort-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
            <div class="sort-buttons">
                <a href="{% url 'questions:list' %}" class="sort-btn {% if request.resolver_match.url_name == 'list' %}active{% endif %}">
                    <span class="sort-icon">üïí</span>
                    –ü–æ –¥–∞—Ç–µ
                </a>
                <a href="{% url 'questions:hot' %}" class="sort-btn {% if request.resolver_match.url_name == 'hot' %}active{% endif %}">
                    <span class="sort-icon">üî•</span>
                    –ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É
                </a>
            </div>
        </div>

        <div class="questions-list">
            {% for question in page %}
            <div class="question-card">
                <div class="vote-buttons">
                    {% if user.is_authenticated %}
                    <form method="post" action="{% url 'questions:vote_question' question.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="vote_type" value="question">
                        <button type="submit" name="value" value="1" class="vote-btn vote-up">‚Üë</button>
                    </form>
                    {% else %}
                    <button type="button" class="vote-btn vote-up disabled">‚Üë</button>
                    {% endif %}

                    <span class="vote-count">{{ question.votes }}</span>

                    {% if user.is_authenticated %}
                    <form method="post" action="{% url 'questions:vote_question' question.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="vote_type" value="question">
                        <button type="submit" name="value" value="-1" class="vote-btn vote-down">‚Üì</button>
                    </form>
                    {% else %}
                    <button type="button" class="vote-btn vote-down disabled">‚Üì</button>
                    {% endif %}
                </div>

                <div class="question-content">
                    <h3><a href="{% url 'questions:detail' question.id %}">{{ question.title }}</a></h3>
                    <p>{{ question.content|striptags|truncatewords:30 }}</p>

                    <div class="tags">
                        {% for tag in question.tags.all %}
                        <a href="{% url 'tags:detail' tag.name %}" class="tag">{{ tag.name }}</a>
                        {% empty %}
                        <span class="tag">–±–µ–∑ —Ç–µ–≥–∞</span>
                        {% endfor %}
                    </div>

                    <div class="meta">
                        <span>—Å–ø—Ä–æ—Å–∏–ª {{ question.created_at|timesince }} –Ω–∞–∑–∞–¥</span>
                        <span>{{ question.answer_set.count }} –æ—Ç–≤–µ—Ç–æ–≤</span>
                        <span>{{ question.views }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                        <div class="author-info">
                            <div class="user-avatar-small">
                                <img src="{% if question.author.avatar %}{{ question.author.avatar.url }}{% else %}{% static 'img/avatar-placeholder.jpg' %}{% endif %}"
                                     alt="–ê–≤–∞—Ç–∞—Ä {{ question.author.username }}" class="avatar-img">
                            </div>
                            <span>{{ question.author.username }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="no-questions">
                <h3>–ü–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤</h3>
                <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –∑–∞–¥–∞—Å—Ç –≤–æ–ø—Ä–æ—Å!</p>
                <a href="{% url 'questions:ask' %}" class="btn btn-primary">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</a>
            </div>
            {% endfor %}
        </div>

        {% include 'includes/pagination.html' with page=page %}
    </div>

    <aside class="sidebar">
        {% include 'includes/sidebar_popular_tags.html' %}
        {% include 'includes/sidebar_top_users.html' %}
    </aside>
</div>
{% endblock %}
